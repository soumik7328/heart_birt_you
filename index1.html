<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>4 Corner Images + Center Box + GSAP Swaps</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<style>
  :root{--bg1:#12021a;--bg2:#40103a}
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;width:100%;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:linear-gradient(180deg,var(--bg1),var(--bg2));overflow:hidden;position:relative;color:#fff}
  .background{position:absolute;top:0;left:0;width:110%;height:110%;background-image:url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1500&q=80');background-size:cover;background-position:center;transform:translateZ(-200px) scale(1.15);transition:transform .18s linear;z-index:-2;filter:brightness(.55) saturate(1.05)}
  body.layout-flex{display:flex;flex-direction:column;justify-content:space-between}
  .row{display:flex;justify-content:space-between;padding:20px;z-index:2}
  .corner-img{width:100px;height:100px;object-fit:cover;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.45);cursor:pointer;user-select:none;touch-action:none}
  .center-box{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:clamp(280px,50vw,520px);height:clamp(180px,35vh,360px);padding:24px;border-radius:20px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.2);backdrop-filter:blur(10px);box-shadow:0 10px 40px rgba(0,0,0,.45);color:#fff;display:flex;align-items:center;justify-content:center;text-align:center;font-size:1.2rem;font-weight:600;z-index:10}
  .controls-fixed{position:fixed;right:18px;top:18px;z-index:20;display:flex;gap:8px}
  .btn{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.12);color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
  .love-layer{position:absolute;inset:0;pointer-events:none;z-index:8}
  .gun{position:absolute;bottom:22px;left:50%;transform:translateX(-50%) rotate(-8deg);width:140px;height:80px;pointer-events:none;background:url('https://cdn-icons-png.flaticon.com/512/3050/3050520.png') no-repeat center/contain;opacity:.95;filter:drop-shadow(0 6px 12px rgba(0,0,0,.5));z-index:9}
  .heart{position:absolute;left:0;top:0;will-change:transform,opacity;user-select:none;line-height:1;transform-origin:center;opacity:1;text-shadow:0 2px 6px rgba(0,0,0,.45);z-index:8;pointer-events:none}
  @media (max-width:720px){.corner-img{width:72px;height:72px}.gun{width:110px;height:60px;bottom:14px}}
</style>
</head>
<body class="layout-flex">

  <div class="background" id="background"></div>

  <!-- top images -->
  <div class="row top">
    <img id="img-tl" class="corner-img" src="https://via.placeholder.com/200x200?text=TL" alt="TL">
    <img id="img-tr" class="corner-img" src="https://via.placeholder.com/200x200?text=TR" alt="TR">
  </div>

  <!-- center box -->
  <div class="center-box">‚ú® This is the Center Box ‚ú®</div>

  <!-- bottom images -->
  <div class="row bottom">
    <img id="img-bl" class="corner-img" src="https://via.placeholder.com/200x200?text=BL" alt="BL">
    <img id="img-br" class="corner-img" src="https://via.placeholder.com/200x200?text=BR" alt="BR">
  </div>

  <!-- gun/hearts -->
  <div class="love-layer" id="loveLayer"></div>
  <div class="gun" id="gun"></div>

  <!-- controls -->
  <div class="controls-fixed">
    <button id="animateBtn" class="btn">Animate Swap</button>
    <button id="autoToggle" class="btn">Auto: ON</button>
  </div>

  <!-- GSAP -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>

<script>
/* ================= background parallax ================= */
const bg = document.getElementById('background');
document.addEventListener('mousemove', (e) => {
  const x = (e.clientX / window.innerWidth - 0.5) * 18;
  const y = (e.clientY / window.innerHeight - 0.5) * 12;
  bg.style.transform = `translate(${x}px, ${y}px) rotateY(${x/5}deg) rotateX(${-y/6}deg) scale(1.12)`;
});

/* ================ GSAP swap logic ================ */
/*
 Strategy:
  - For each swap pair (elA, elB):
    1. get bounding rects
    2. compute delta positions (dx, dy)
    3. animate both to other's position using gsap (translate + rotation)
    4. onComplete: exchange src attributes and reset transforms (so DOM visually swapped)
*/
const imgTL = document.getElementById('img-tl');
const imgTR = document.getElementById('img-tr');
const imgBL = document.getElementById('img-bl');
const imgBR = document.getElementById('img-br');

function swapImagesWithAnimation(elA, elB, opts = {}) {
  const { duration = 0.9, rotate = 360, ease = "power2.inOut", scale = 1.05 } = opts;
  const rectA = elA.getBoundingClientRect();
  const rectB = elB.getBoundingClientRect();
  // compute difference from A -> B and B -> A
  const dxA = rectB.left - rectA.left;
  const dyA = rectB.top - rectA.top;
  const dxB = rectA.left - rectB.left;
  const dyB = rectA.top - rectB.top;

  // Save srcs to swap later
  const srcA = elA.src;
  const srcB = elB.src;
  const altA = elA.alt;
  const altB = elB.alt;

  // perform animation (use absolute translation via x/y transforms)
  // bring them slightly forward using z (simulated by scale)
  const tl = gsap.timeline();

  // raise z-order visually while animating
  elA.style.zIndex = 30; elB.style.zIndex = 30;

  tl.to(elA, {duration: duration, x: dxA, y: dyA, rotation: rotate * (Math.random() > 0.5 ? 1 : -1), scale: scale, ease: ease}, 0);
  tl.to(elB, {duration: duration, x: dxB, y: dyB, rotation: rotate * (Math.random() > 0.5 ? -1 : 1), scale: scale, ease: ease}, 0);

  // little bounce/settle
  tl.to([elA, elB], {duration: 0.25, scale: 1, rotation: 0, ease: "elastic.out(1,0.6)"});

  tl.add(()=> {
    // swap the src & alt in DOM so they remain visually swapped
    elA.src = srcB; elB.src = srcA;
    elA.alt = altB; elB.alt = altA;
    // reset transforms so they sit in layout normally
    gsap.set([elA, elB], {clearProps: "all"});
    elA.style.zIndex = ""; elB.style.zIndex = "";
  });

  return tl;
}

/* Steps definition:
   1) swap TL <-> TR with rotation
   2) swap BL <-> BR with rotation
   3) diagonal swap: TL <-> BR and TR <-> BL (diagonal movement)
*/
function runSwapSequence() {
  const main = gsap.timeline();
  main.add( swapImagesWithAnimation(imgTL, imgTR, {duration:0.9, rotate:420, scale:1.08}) );
  main.add( swapImagesWithAnimation(imgBL, imgBR, {duration:0.9, rotate:420, scale:1.08}), "+=0.12" );
  // diagonal: animate both pairs simultaneously with a diagonal bias
  main.add( swapImagesWithAnimation(imgTL, imgBR, {duration:1.05, rotate:540, scale:1.12}), "+=0.25" );
  main.add( swapImagesWithAnimation(imgTR, imgBL, {duration:1.05, rotate:540, scale:1.12}), "<" );
  return main;
}

/* wire button */
const animateBtn = document.getElementById('animateBtn');
animateBtn.addEventListener('click', () => runSwapSequence());

/* Optional auto-run */
let autoOn = true;
const autoToggle = document.getElementById('autoToggle');
autoToggle.addEventListener('click', () => {
  autoOn = !autoOn;
  autoToggle.textContent = `Auto: ${autoOn ? 'ON' : 'OFF'}`;
});

let autoTimer = null;
function startAuto() {
  if(!autoOn) return;
  // run sequence every 8 seconds
  runSwapSequence();
  autoTimer = setInterval(()=> { if(autoOn) runSwapSequence(); }, 8000);
}
function stopAuto() { clearInterval(autoTimer); autoTimer = null; }

startAuto(); // starts after load
// minor initial delay for nicer effect
setTimeout(()=> { if(autoOn) runSwapSequence(); }, 1500);

/* stop auto when page hidden to save CPU */
document.addEventListener('visibilitychange', ()=> {
  if(document.hidden) { stopAuto(); } else { if(autoOn) startAuto(); }
});

/* ================ existing love-gun effect kept (original) ================ */
/* minimal integration: reuse previous heart/gun code (kept simpler here) */
(function () {
  const loveLayer = document.getElementById('loveLayer');
  const gun = document.getElementById('gun');
  const BURST_INTERVAL = 900;
  const HEARTS_PER_BURST = 14;
  const MAX_HEARTS_ON_SCREEN = 400;
  const HEART_LIFE = 6000;

  function getGunSpawnPoint(){
    const r = gun.getBoundingClientRect();
    return { x: r.left + r.width * 0.6, y: r.top + r.height * 0.45 };
  }
  function rand(min,max){ return Math.random()*(max-min)+min; }
  function makeHeart(x,y){
    const el = document.createElement('div');
    el.className = 'heart';
    const chars = ['‚ù§','üíñ','üíò','üíû'];
    el.textContent = chars[Math.floor(Math.random()*chars.length)];
    const size = 18 + Math.random()*42;
    el.style.fontSize = `${size}px`;
    el.style.left = `${x - size/2}px`;
    el.style.top = `${y - size/2}px`;
    el.style.transform = `translate3d(0,0,0) rotate(${(Math.random()-0.5)*60}deg) scale(${0.6 + Math.random()*0.9})`;
    return el;
  }
  function launchHeart(el){
    const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
    const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
    const base = -Math.PI/2;
    let angle = base + (Math.random()-0.5)*Math.PI*0.85;
    if(Math.random() < 0.12) angle = (Math.random()-0.5)*Math.PI*2;
    const maxDist = Math.hypot(vw,vh) * (0.6 + Math.random()*0.9);
    const tx = Math.cos(angle)*maxDist, ty = Math.sin(angle)*maxDist;
    const rot = (Math.random()-0.5)*720;
    const duration = 2500 + Math.random()*3800;
    el.style.transition = `transform ${duration}ms cubic-bezier(.16,.84,.44,1), opacity ${duration}ms linear`;
    el.style.transitionDelay = `${Math.random()*220}ms`;
    requestAnimationFrame(()=> {
      el.style.transform = `translate3d(${tx}px, ${ty}px, 0) rotate(${rot}deg) scale(${0.8 + Math.random()*0.9})`;
      el.style.opacity = `${0.02 + Math.random()*0.6}`;
    });
    setTimeout(()=> {
      if(!el.parentElement) return;
      el.classList.add('drift');
      el.style.opacity = '0.85';
      el.style.transition = '';
    }, duration + 250);
    setTimeout(()=> {
      if(el.parentElement){ el.style.transition='opacity 500ms linear'; el.style.opacity='0'; setTimeout(()=>el.remove(),520); }
    }, HEART_LIFE);
  }
  function burst(){
    const live = loveLayer.querySelectorAll('.heart').length;
    if(live > MAX_HEARTS_ON_SCREEN) return;
    const spawn = getGunSpawnPoint();
    for(let i=0;i<HEARTS_PER_BURST;i++){
      const h = makeHeart(spawn.x, spawn.y);
      loveLayer.appendChild(h);
      setTimeout(()=> launchHeart(h), Math.random()*140);
    }
  }
  const burstTimer = setInterval(burst, BURST_INTERVAL);
  setTimeout(()=> { burst(); burst(); }, 420);
  gun.addEventListener('click', ()=> { for(let i=0;i<4;i++) setTimeout(burst, i*140); });
  window.addEventListener('beforeunload', ()=> clearInterval(burstTimer));
})();

</script>
</body>
</html>
